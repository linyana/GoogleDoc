<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Google Sheets Data Viewer</title>
</head>
<body>
  <h2>Google Sheets 实时数据</h2>
  <div id="output">Loading...</div>

  <script>
    const sheetID = '1wyxggYVyxiv25G2aB8XW3yTUt5UvfU2HKeReny_1mUE';
    const sheetName = 'Sheet1'; // 请替换为你的实际工作表名
    const query = encodeURIComponent('SELECT *');
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?sheet=${sheetName}&tq=${query}`;

    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const json = JSON.parse(rep.match(/google\.visualization\.Query\.setResponse\((.*)\);/)[1]);
        const table = json.table;

       // 从 table.rows[0] 读取标题行，覆盖 table.cols.label
        const titleRow = table.rows[0].c.map(cell => cell?.v ?? '');

        // 判断 image 列
        const isImageColumn = titleRow.map(title => title.toLowerCase().startsWith('image'));

        // 渲染表头
        let html = '<table border="1" cellspacing="0" cellpadding="5"><tr>';
        titleRow.forEach(title => {
          html += `<th>${title}</th>`;
        });
        html += '</tr>';

        // 渲染数据，从第2行开始（跳过我们刚当作标题的 row）
        for (let i = 1; i < table.rows.length; i++) {
          const row = table.rows[i];
          html += '<tr>';
          row.c.forEach((cell, colIndex) => {
            const value = cell?.v ?? '';
            if (isImageColumn[colIndex]) {
              html += value ? `<td><img src="${value}" alt="image" style="max-width:100px; max-height:100px;" /></td>` : '<td></td>';
            } else {
              html += `<td>${value}</td>`;
            }
          });
          html += '</tr>';
        }


        html += '</table>';
        document.getElementById('output').innerHTML = html;
      })
      .catch(err => {
        document.getElementById('output').innerText = '加载失败：' + err;
        console.error(err);
      });
  </script>
</body>
</html>
